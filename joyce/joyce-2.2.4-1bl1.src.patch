--- origsrc/joyce-2.2.4/LibLink/include/Makefile.am	2002-05-12 01:56:05.000000000 +0900
+++ src/joyce-2.2.4/LibLink/include/Makefile.am	2011-08-09 08:29:42.494381200 +0900
@@ -1,2 +0,0 @@
-include_HEADERS = liblink.h
-
--- origsrc/joyce-2.2.4/LibLink/lib/Makefile.am	2002-07-23 07:54:05.000000000 +0900
+++ src/joyce-2.2.4/LibLink/lib/Makefile.am	2011-08-09 08:30:08.970124500 +0900
@@ -7,7 +7,7 @@ JAR=@JAR@
 CLASSCPRE=uk.co.demon.seasip.liblink
 CLASSDPRE=uk/co/demon/seasip/liblink
 HEADERPRE=uk_co_demon_seasip_liblink
-lib_LTLIBRARIES=liblink.la
+noinst_LTLIBRARIES=liblink.la
 noinst_PROGRAMS=@LLINKJAR@
 EXTRA_PROGRAMS=
 EXTRA_DIST=$(CLASSDPRE)/LibLink.java \
--- origsrc/joyce-2.2.4/Makefile.am	2010-06-29 05:21:28.000000000 +0900
+++ src/joyce-2.2.4/Makefile.am	2011-08-09 08:30:20.510449700 +0900
@@ -1,5 +1,5 @@
 
-SUBDIRS=share cpmredir 765 SdlTerm SdSdl LibDsk LibLink Xbm Docs bin .
+SUBDIRS=share cpmredir SdlTerm SdSdl LibLink Xbm Docs bin .
 
 EXTRA_DIST=$(srcdir)/config/*  $(srcdir)/ministl/* $(srcdir)/m4/* \
 	COPYING.txt \
--- origsrc/joyce-2.2.4/SdlTerm/cnvshell.c	2001-08-26 07:03:13.000000000 +0900
+++ src/joyce-2.2.4/SdlTerm/cnvshell.c	2011-08-09 09:01:43.263330200 +0900
@@ -42,7 +42,7 @@ static int isarg(char *s)
 /* Case-insensitive string comparison */
 
 #ifndef HAVE_STRICMP
-
+#if !defined(__CYGWIN__)
 int stricmp(char *s, char *t)
     {
     char a,b;
@@ -59,7 +59,7 @@ int stricmp(char *s, char *t)
         }
     return (*s) - (*t);
     }
-
+#endif
 #endif
 
 /* Display help screen */
--- origsrc/joyce-2.2.4/SdlTerm/cnvshell.h	2001-08-26 07:03:14.000000000 +0900
+++ src/joyce-2.2.4/SdlTerm/cnvshell.h	2011-08-09 09:01:16.995559000 +0900
@@ -40,8 +40,10 @@ extern char *cnv_progname;
 #endif
 
 #ifndef HAVE_STRICMP
+#if !defined(__CYGWIN__)
 extern int stricmp(char *s, char *t);
 #endif
+#endif
 
 /* Pacific C doesn't define these */
 #ifndef SEEK_SET 
--- origsrc/joyce-2.2.4/bin/Makefile.am	2005-12-15 20:41:11.000000000 +0900
+++ src/joyce-2.2.4/bin/Makefile.am	2011-08-09 09:24:40.992069400 +0900
@@ -1,10 +1,10 @@
 INCLUDES=-I$(top_srcdir)/765/include -I$(top_srcdir)/SdlTerm  -I$(top_srcdir)/Xbm -I$(top_srcdir)/SdSdl
 
 bin_PROGRAMS=xjoyce xanne
-noinst_LIBRARIES=libjoyce.a
+noinst_LTLIBRARIES=libjoyce.la
 
-xjoyce_LDADD=-L. -ljoyce ../SdlTerm/libsdlterm.la ../SdSdl/libsdsdl.la ../765/lib/lib765.la ../LibDsk/lib/libdsk.la ../LibLink/lib/liblink.la
-xanne_LDADD=-L.  -ljoyce ../SdlTerm/libsdlterm.la ../SdSdl/libsdsdl.la ../765/lib/lib765.la ../LibDsk/lib/libdsk.la ../LibLink/lib/liblink.la
+xjoyce_LDADD=-L. -ljoyce ../SdlTerm/libsdlterm.la ../SdSdl/libsdsdl.la -l765 -ldsk ../LibLink/lib/liblink.la @LIBPNG_LIBS@
+xanne_LDADD=-L. -ljoyce ../SdlTerm/libsdlterm.la ../SdSdl/libsdsdl.la -l765 -ldsk ../LibLink/lib/liblink.la
 xjoyce_SOURCES=Joyce.cxx            Joyce.hxx       \
 	       JoyceSystem.cxx      JoyceSystem.hxx \
 	       JoyceArgs.cxx        JoyceArgs.hxx   \
@@ -48,7 +48,7 @@ xanne_SOURCES=Anne.cxx         Anne.hxx
 	      FlashChip.cxx    FlashChip.hxx	\
 	      Z80a.cxx         ImcZ80a.hxx
 
-libjoyce_a_SOURCES=        		       \
+libjoyce_la_SOURCES=        		       \
 	Executor.cxx	   Executor.hxx        \
 	GdiPrint.cxx	   GdiPrint.hxx	       \
 	Path.cxx           Path.hxx            \
--- origsrc/joyce-2.2.4/configure.in	2010-06-29 04:19:48.000000000 +0900
+++ src/joyce-2.2.4/configure.in	2011-08-09 08:35:46.996778000 +0900
@@ -41,8 +41,6 @@ if test x$enable_floppy = xyes; then
 else
     CFLAGS="$CFLAGS -DDISABLE_FLOPPY"
 fi
-dnl Don't build a .so version of LibDsk; JOYCE will use the static one.
-AC_DISABLE_SHARED
 
 CPPFLAGS="$CPPFLAGS $MINISTL_CFLAGS"
 
@@ -82,11 +80,15 @@ AC_CHECK_HEADERS(glob.h termios.h)
 AC_CHECK_HEADERS(fcntl.h limits.h sys/ioctl.h sys/time.h sys/types.h unistd.h)
 AC_CHECK_HEADERS(sys/vfs.h utime.h time.h)
 AC_CHECK_HEADERS(errno.h sys/errno.h sys/stat.h sys/mman.h fcntl.h)
-AC_CHECK_HEADERS(linux/fd.h linux/fdreg.h windows.h winioctl.h)
+AC_CHECK_HEADERS(linux/fd.h linux/fdreg.h)
 AC_CHECK_HEADERS(sys/socket.h sys/un.h netinet/in.h netdb.h)
 AC_CHECK_HEADERS(linux/parport.h linux/ppdev.h termios.h)
-AC_CHECK_HEADERS(windows.h winnt.h winsock.h conio.h)
+AC_CHECK_HEADERS(conio.h)
 AC_CHECK_HEADERS(kernel/fs_info.h sys/param.h sys/mount.h)
+case "$host_os" in
+cygwin*) ;;
+*) AC_CHECK_HEADERS(windows.h winnt.h winsock.h winioctl.h) ;;
+esac
 
 dnl
 dnl Don't replicate the nassty fudge in LibLink for checking -lwsock32;
@@ -179,7 +181,7 @@ else
 fi 
 ])
 
-AC_CHECK_LIB(png, png_init_io, , [echo "libpng not found - aborting"; exit 1])
+PKG_CHECK_MODULES([LIBPNG], [libpng])
 
 dnl Checks for typedefs, structures, and compiler characteristics.
 AC_C_CONST
--- origsrc/joyce-2.2.4/cpmredir/include/Makefile.am	2001-07-07 21:33:42.000000000 +0900
+++ src/joyce-2.2.4/cpmredir/include/Makefile.am	2011-08-09 09:36:50.328609000 +0900
@@ -1,2 +1,2 @@
-include_HEADERS = cpmredir.h
+#include_HEADERS = cpmredir.h
 
--- origsrc/joyce-2.2.4/cpmredir/lib/Makefile.am	2001-08-27 05:21:32.000000000 +0900
+++ src/joyce-2.2.4/cpmredir/lib/Makefile.am	2011-08-09 09:37:03.126699700 +0900
@@ -2,7 +2,7 @@
 
 INCLUDES=-I$(top_srcdir)/cpmredir/include
 
-lib_LIBRARIES=libcpmredir.a
-libcpmredir_a_SOURCES = cpmdrv.c   cpmint.h	  cpmredir.c  util.c \
+noinst_LTLIBRARIES=libcpmredir.la
+libcpmredir_la_SOURCES = cpmdrv.c   cpmint.h	  cpmredir.c  util.c \
 		   cpmglob.c  cpmparse.c  drdos.c     xlt.c
 
--- origsrc/joyce-2.2.4/cpmredir/lib/cpmredir.c	2000-05-16 07:02:46.000000000 +0900
+++ src/joyce-2.2.4/cpmredir/lib/cpmredir.c	2011-08-09 08:34:51.534560300 +0900
@@ -362,7 +362,7 @@ cpm_word fcb_creat(cpm_byte *fcb, cpm_by
 
 	if (fcb[0] & 0x80)
 	{
-#ifdef WIN32
+#if defined(WIN32) && !defined(__CYGWIN__)
 		handle = mkdir(fname);
 #else
 		handle = mkdir(fname, 0x777);
