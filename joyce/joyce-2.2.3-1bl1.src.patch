--- origsrc/joyce-2.2.3/LibLink/include/Makefile.am	2002-05-12 01:56:05.000000000 +0900
+++ src/joyce-2.2.3/LibLink/include/Makefile.am	2010-10-18 00:21:06.454851900 +0900
@@ -1,2 +1,2 @@
-include_HEADERS = liblink.h
+#include_HEADERS = liblink.h
 
--- origsrc/joyce-2.2.3/LibLink/lib/Makefile.am	2002-07-23 07:54:05.000000000 +0900
+++ src/joyce-2.2.3/LibLink/lib/Makefile.am	2010-10-17 16:01:11.779674900 +0900
@@ -7,7 +7,7 @@ JAR=@JAR@
 CLASSCPRE=uk.co.demon.seasip.liblink
 CLASSDPRE=uk/co/demon/seasip/liblink
 HEADERPRE=uk_co_demon_seasip_liblink
-lib_LTLIBRARIES=liblink.la
+noinst_LTLIBRARIES=liblink.la
 noinst_PROGRAMS=@LLINKJAR@
 EXTRA_PROGRAMS=
 EXTRA_DIST=$(CLASSDPRE)/LibLink.java \
--- origsrc/joyce-2.2.3/Makefile.am	2009-11-09 00:40:59.000000000 +0900
+++ src/joyce-2.2.3/Makefile.am	2010-10-17 15:58:47.560924900 +0900
@@ -1,5 +1,5 @@
 
-SUBDIRS=share cpmredir 765 SdlTerm SdSdl LibDsk LibLink Xbm Docs bin .
+SUBDIRS=share cpmredir SdlTerm SdSdl LibLink Xbm Docs bin .
 
 SOURCES=md3trans.exe pcwtrans.exe pcw.png font8x16.x16 
 EXTRA_DIST=$(srcdir)/config/*  $(srcdir)/ministl/* COPYING.txt \
--- origsrc/joyce-2.2.3/SdSdl/Makefile.am	2005-04-21 06:39:04.000000000 +0900
+++ src/joyce-2.2.3/SdSdl/Makefile.am	2010-10-17 17:46:13.725812900 +0900
@@ -26,7 +26,7 @@ libsdsdl_la_SOURCES = drv_bits.cc   drv_
 
 vfntcnv_SOURCES=vfntcnv.c
 
-vfntcnv:	vfntcnv.c
+#vfntcnv:	vfntcnv.c
 #
 # This is commented out because I can't cross-compile Joyce with it in.
 #
--- origsrc/joyce-2.2.3/SdlTerm/cnvshell.c	2001-08-26 07:03:13.000000000 +0900
+++ src/joyce-2.2.3/SdlTerm/cnvshell.c	2010-10-17 17:40:55.663312900 +0900
@@ -42,6 +42,7 @@ static int isarg(char *s)
 /* Case-insensitive string comparison */
 
 #ifndef HAVE_STRICMP
+#if !defined(__CYGWIN__)
 
 int stricmp(char *s, char *t)
     {
@@ -61,6 +62,7 @@ int stricmp(char *s, char *t)
     }
 
 #endif
+#endif
 
 /* Display help screen */
 
--- origsrc/joyce-2.2.3/SdlTerm/cnvshell.h	2001-08-26 07:03:14.000000000 +0900
+++ src/joyce-2.2.3/SdlTerm/cnvshell.h	2010-10-17 17:39:02.225812900 +0900
@@ -40,8 +40,10 @@ extern char *cnv_progname;
 #endif
 
 #ifndef HAVE_STRICMP
+#if !defined(__CYGWIN__)
 extern int stricmp(char *s, char *t);
 #endif
+#endif
 
 /* Pacific C doesn't define these */
 #ifndef SEEK_SET 
--- origsrc/joyce-2.2.3/bin/Makefile.am	2005-12-15 20:41:11.000000000 +0900
+++ src/joyce-2.2.3/bin/Makefile.am	2010-10-17 23:49:24.618088900 +0900
@@ -1,10 +1,10 @@
-INCLUDES=-I$(top_srcdir)/765/include -I$(top_srcdir)/SdlTerm  -I$(top_srcdir)/Xbm -I$(top_srcdir)/SdSdl
+INCLUDES=-I$(top_srcdir)/SdlTerm -I$(top_srcdir)/Xbm -I$(top_srcdir)/SdSdl @LIBPNG_CFLAGS@
 
 bin_PROGRAMS=xjoyce xanne
-noinst_LIBRARIES=libjoyce.a
+noinst_LTLIBRARIES=libjoyce.la
 
-xjoyce_LDADD=-L. -ljoyce ../SdlTerm/libsdlterm.la ../SdSdl/libsdsdl.la ../765/lib/lib765.la ../LibDsk/lib/libdsk.la ../LibLink/lib/liblink.la
-xanne_LDADD=-L.  -ljoyce ../SdlTerm/libsdlterm.la ../SdSdl/libsdsdl.la ../765/lib/lib765.la ../LibDsk/lib/libdsk.la ../LibLink/lib/liblink.la
+xjoyce_LDADD=-L. -ljoyce ../SdlTerm/libsdlterm.la ../SdSdl/libsdsdl.la -l765 -ldsk ../LibLink/lib/liblink.la @LIBPNG_LIBS@
+xanne_LDADD=-L.  -ljoyce ../SdlTerm/libsdlterm.la ../SdSdl/libsdsdl.la -l765 -ldsk ../LibLink/lib/liblink.la
 xjoyce_SOURCES=Joyce.cxx            Joyce.hxx       \
 	       JoyceSystem.cxx      JoyceSystem.hxx \
 	       JoyceArgs.cxx        JoyceArgs.hxx   \
@@ -48,7 +48,7 @@ xanne_SOURCES=Anne.cxx         Anne.hxx
 	      FlashChip.cxx    FlashChip.hxx	\
 	      Z80a.cxx         ImcZ80a.hxx
 
-libjoyce_a_SOURCES=        		       \
+libjoyce_la_SOURCES=        		       \
 	Executor.cxx	   Executor.hxx        \
 	GdiPrint.cxx	   GdiPrint.hxx	       \
 	Path.cxx           Path.hxx            \
--- origsrc/joyce-2.2.3/configure.in	2010-06-10 04:43:51.000000000 +0900
+++ src/joyce-2.2.3/configure.in	2010-10-17 22:41:06.868088900 +0900
@@ -18,7 +18,7 @@ else
         cd $DSTROOT
 fi
 
-AC_CYGWIN
+#AC_CYGWIN
 AC_MINGW32
 AC_EXEEXT
 dnl Add cpmredir to list of things to do
@@ -40,8 +40,6 @@ if test x$enable_floppy = xyes; then
 else
     CFLAGS="$CFLAGS -DDISABLE_FLOPPY"
 fi
-dnl Don't build a .so version of LibDsk; JOYCE will use the static one.
-AC_DISABLE_SHARED
 
 CPPFLAGS="$CPPFLAGS $MINISTL_CFLAGS"
 
@@ -61,7 +59,7 @@ dnl Checks for programs.
 AC_PROG_CXX
 AC_PROG_CC
 AC_PROG_INSTALL
-AM_PROG_LIBTOOL
+LT_INIT(win32-dll)
 dnl Obsoleted by LIBTOOL AC_PROG_RANLIB
 AC_PROG_MAKE_SET
 
@@ -81,11 +79,15 @@ AC_CHECK_HEADERS(glob.h termios.h)
 AC_CHECK_HEADERS(fcntl.h limits.h sys/ioctl.h sys/time.h sys/types.h unistd.h)
 AC_CHECK_HEADERS(sys/vfs.h utime.h time.h)
 AC_CHECK_HEADERS(errno.h sys/errno.h sys/stat.h sys/mman.h fcntl.h)
-AC_CHECK_HEADERS(linux/fd.h linux/fdreg.h windows.h winioctl.h)
+AC_CHECK_HEADERS(linux/fd.h linux/fdreg.h)
 AC_CHECK_HEADERS(sys/socket.h sys/un.h netinet/in.h netdb.h)
 AC_CHECK_HEADERS(linux/parport.h linux/ppdev.h termios.h)
-AC_CHECK_HEADERS(windows.h winnt.h winsock.h conio.h)
+AC_CHECK_HEADERS(conio.h)
 AC_CHECK_HEADERS(kernel/fs_info.h sys/param.h sys/mount.h)
+case "$host_os" in
+cygwin*) ;;
+*) AC_CHECK_HEADERS(windows.h winnt.h winsock.h winioctl.h) ;;
+esac
 
 dnl
 dnl Don't replicate the nassty fudge in LibLink for checking -lwsock32;
@@ -178,7 +180,9 @@ else
 fi 
 ])
 
-AC_CHECK_LIB(png, png_init_io, , [echo "libpng not found - aborting"; exit 1])
+PKG_CHECK_MODULES([LIBPNG], [libpng12], ,[
+  PKG_CHECK_MODULES([LIBPNG], [libpng])
+])
 
 dnl Checks for typedefs, structures, and compiler characteristics.
 AC_C_CONST
--- origsrc/joyce-2.2.3/cpmredir/include/Makefile.am	2001-07-07 21:33:42.000000000 +0900
+++ src/joyce-2.2.3/cpmredir/include/Makefile.am	2010-10-18 00:21:42.001726900 +0900
@@ -1,2 +1,2 @@
-include_HEADERS = cpmredir.h
+#include_HEADERS = cpmredir.h
 
--- origsrc/joyce-2.2.3/cpmredir/lib/Makefile.am	2001-08-27 05:21:32.000000000 +0900
+++ src/joyce-2.2.3/cpmredir/lib/Makefile.am	2010-10-17 17:26:14.991437900 +0900
@@ -2,7 +2,7 @@
 
 INCLUDES=-I$(top_srcdir)/cpmredir/include
 
-lib_LIBRARIES=libcpmredir.a
-libcpmredir_a_SOURCES = cpmdrv.c   cpmint.h	  cpmredir.c  util.c \
+noinst_LTLIBRARIES=libcpmredir.la
+libcpmredir_la_SOURCES = cpmdrv.c   cpmint.h	  cpmredir.c  util.c \
 		   cpmglob.c  cpmparse.c  drdos.c     xlt.c
 
--- origsrc/joyce-2.2.3/cpmredir/lib/cpmredir.c	2000-05-16 07:02:46.000000000 +0900
+++ src/joyce-2.2.3/cpmredir/lib/cpmredir.c	2010-10-17 17:30:34.241437900 +0900
@@ -362,7 +362,7 @@ cpm_word fcb_creat(cpm_byte *fcb, cpm_by
 
 	if (fcb[0] & 0x80)
 	{
-#ifdef WIN32
+#if defined(WIN32) && !defined(__CYGWIN__)
 		handle = mkdir(fname);
 #else
 		handle = mkdir(fname, 0x777);
--- origsrc/joyce-2.2.3/share/Makefile.am	2002-09-28 06:28:08.000000000 +0900
+++ src/joyce-2.2.3/share/Makefile.am	2010-10-18 00:30:14.579851900 +0900
@@ -2,14 +2,14 @@ SOURCES = bootfile.emj  pcw.bmp  pcwkey.
 	  16power2.bmp 16power3.bmp pcw16.bmp
 
 install-data-local:
-	$(mkinstalldirs) $(datadir)/Joyce
-	$(mkinstalldirs) $(datadir)/Joyce/Boot
-	$(mkinstalldirs) $(datadir)/Joyce/Disks
-	$(INSTALL_DATA) $(srcdir)/pcw.bmp $(datadir)/Joyce
-	$(INSTALL_DATA) $(srcdir)/pcw16.bmp $(datadir)/Joyce
-	$(INSTALL_DATA) $(srcdir)/pcwkey.bmp $(datadir)/Joyce
-	$(INSTALL_DATA) $(srcdir)/16power2.bmp $(datadir)/Joyce
-	$(INSTALL_DATA) $(srcdir)/16power3.bmp $(datadir)/Joyce
-	$(INSTALL_DATA) $(srcdir)/bootfile.emj $(datadir)/Joyce/Boot
-	$(INSTALL_DATA) $(srcdir)/utils.dsk $(datadir)/Joyce/Disks
-	$(INSTALL_DATA) $(srcdir)/utils16.dsk $(datadir)/Joyce/Disks
+	$(mkinstalldirs) $(DESTDIR)$(datadir)/Joyce
+	$(mkinstalldirs) $(DESTDIR)$(datadir)/Joyce/Boot
+	$(mkinstalldirs) $(DESTDIR)$(datadir)/Joyce/Disks
+	$(INSTALL_DATA) $(srcdir)/pcw.bmp $(DESTDIR)$(datadir)/Joyce
+	$(INSTALL_DATA) $(srcdir)/pcw16.bmp $(DESTDIR)$(datadir)/Joyce
+	$(INSTALL_DATA) $(srcdir)/pcwkey.bmp $(DESTDIR)$(datadir)/Joyce
+	$(INSTALL_DATA) $(srcdir)/16power2.bmp $(DESTDIR)$(datadir)/Joyce
+	$(INSTALL_DATA) $(srcdir)/16power3.bmp $(DESTDIR)$(datadir)/Joyce
+	$(INSTALL_DATA) $(srcdir)/bootfile.emj $(DESTDIR)$(datadir)/Joyce/Boot
+	$(INSTALL_DATA) $(srcdir)/utils.dsk $(DESTDIR)$(datadir)/Joyce/Disks
+	$(INSTALL_DATA) $(srcdir)/utils16.dsk $(DESTDIR)$(datadir)/Joyce/Disks
