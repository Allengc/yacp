--- origsrc/freedroidrpg-0.13/configure.ac	2010-01-21 21:56:26.000000000 +0900
+++ src/freedroidrpg-0.13/configure.ac	2010-05-02 21:52:54.361509000 +0900
@@ -29,7 +29,7 @@ fi
 CFLAGS="$CFLAGS -Wall"
 
 case "$target" in
-	*-*-cygwin* | *-*-mingw32*)
+	*-*-mingw32*)
 	CFLAGS="$CFLAGS  -DFD_DATADIR='\".\"'"
 	SYS_GL_LIB=opengl32
 	win32=true
@@ -186,6 +186,10 @@ It is recommended to use openGL.
    fi
 fi
 
+PKG_CHECK_MODULES(LUA, lua)
+AC_SUBST(LUA_CFLAGS)
+AC_SUBST(LUA_LIBS)
+
 # Checks for header files.
 AC_CHECK_HEADERS([fcntl.h stdlib.h string.h sys/ioctl.h sys/time.h time.h \
 			  unistd.h dirent.h sys/soundcard.h soundcard.h execinfo.h signal.h locale.h stdint.h libintl.h libgen.h langinfo.h])
--- origsrc/freedroidrpg-0.13/Makefile.am	2010-01-21 21:38:47.000000000 +0900
+++ src/freedroidrpg-0.13/Makefile.am	2010-05-02 21:55:08.908384000 +0900
@@ -14,7 +14,7 @@ SUBDIRS = src gluem $(extradirs)
 
 freedroid_data = map graphics sound dialogs
 
-EXTRA_DIST = m4 $(freedroid_data) HELP_WANTED INSTALL.generic lua
+EXTRA_DIST = m4 $(freedroid_data) HELP_WANTED INSTALL.generic
 
 dist-hook:
 	find $(distdir) -name ".svn"                 | xargs rm -rf
@@ -25,8 +25,8 @@ dist-hook:
 install-data-local:
 	@echo "Installing the data-files ..."
 	$(mkinstalldirs) $(DESTDIR)$(pkgdatadir)
-	find $(srcdir)/$(freedroid_data) -type d ! -name "*.blend" -and ! -path "*CVS*" -and ! -path "*.svn" -and ! -name "Makefile*" -and ! -name "*~" -and ! -name ".#*" -exec echo $(DESTDIR)$(pkgdatadir)/{} \; | xargs $(mkinstalldirs)
-	find $(srcdir)/$(freedroid_data) -type f ! -name "*.blend" -and ! -path "*CVS*" -and ! -path "*.svn" -and ! -name "Makefile*" -and ! -name "*~" -and ! -name ".#*" -exec cp -p {} $(DESTDIR)$(pkgdatadir)/{} \; #for files
+	(cd $(top_srcdir) && find $(freedroid_data) -type d ! -name "*.blend" -and ! -path "*CVS*" -and ! -path "*.svn" -and ! -name "Makefile*" -and ! -name "*~" -and ! -name ".#*" -exec echo $(DESTDIR)$(pkgdatadir)/{} \; | xargs $(mkinstalldirs))
+	(cd $(top_srcdir) && find $(freedroid_data) -type f ! -name "*.blend" -and ! -path "*CVS*" -and ! -path "*.svn" -and ! -name "Makefile*" -and ! -name "*~" -and ! -name ".#*" -exec cp -p {} $(DESTDIR)$(pkgdatadir)/{} \;)
 	@echo "..done."
 
 uninstall-local:
--- origsrc/freedroidrpg-0.13/src/init.c	2010-01-21 21:31:29.000000000 +0900
+++ src/freedroidrpg-0.13/src/init.c	2010-05-02 21:52:54.424009000 +0900
@@ -37,7 +37,7 @@
 #include "global.h"
 #include "proto.h"
 
-#ifdef __OpenBSD__
+#if defined(__OpenBSD__) || defined(__CYGWIN__)
 #include "ieeefp.h"
 #else
 #include "fenv.h"
--- origsrc/freedroidrpg-0.13/src/main.c	2010-01-21 21:31:29.000000000 +0900
+++ src/freedroidrpg-0.13/src/main.c	2010-05-02 21:52:54.502134000 +0900
@@ -37,7 +37,7 @@
 #include "proto.h"
 #include "vars.h"
 
-#ifdef __OpenBSD__
+#if defined(__OpenBSD__) || defined(__CYGWIN__)
 #include "ieeefp.h"
 #else
 #include "fenv.h"
--- origsrc/freedroidrpg-0.13/src/Makefile.am	2010-01-21 21:31:29.000000000 +0900
+++ src/freedroidrpg-0.13/src/Makefile.am	2010-05-02 22:21:15.549009000 +0900
@@ -1,6 +1,6 @@
 ## Process this file with automake to produce Makefile.in
 
-freedroidRPG_LDADD = ../lua/liblua.a
+freedroidRPG_LDADD = @LUA_LIBS@
 
 if WIN32
 freedroidRPG_LDADD += ../win32/freedroidRPG.coff
@@ -46,11 +46,6 @@ freedroidRPG_SOURCES = menu.c shop.c ite
 savestruct.c savestruct.h: struct.h gen_savestruct.py
 	python gen_savestruct.py struct.h savestruct
 
-clean-local:
-	cd ../lua; make clean
-
-../lua/liblua.a: 
-	cd ../lua; make CC=${CC} AR="${AR} rcu" liblua.a
 if WIN32
 	i686-pc-mingw32-ranlib ../lua/liblua.a
 endif
