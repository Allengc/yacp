--- origsrc/uprof/configure.in	2010-12-30 17:08:50.000000000 +0900
+++ src/uprof/configure.in	2010-12-30 17:09:28.623410200 +0900
@@ -79,8 +79,6 @@ AC_SUBST(UPROF_LT_REVISION)
 AC_SUBST(UPROF_LT_AGE)
 AC_SUBST(UPROF_LT_RELEASE)
 
-AM_MAINTAINER_MODE
-
 
 dnl ================================================================
 dnl Handle extra configure options
@@ -116,7 +114,7 @@ AC_C_CONST
 dnl ================================================================
 dnl Libtool stuff.
 dnl ================================================================
-AC_PROG_LIBTOOL
+LT_INIT(win32-dll)
 LIBTOOL="$LIBTOOL --preserve-dup-deps"
 
 
--- origsrc/uprof/tests/Makefile.am	2010-12-30 17:08:50.000000000 +0900
+++ src/uprof/tests/Makefile.am	2010-12-30 17:33:18.492461100 +0900
@@ -21,10 +21,6 @@ dlopen_LDFLAGS = \
 
 dlopen_LDADD = -ldl
 
-all-local: module.so
-include ./$(DEPDIR)/module.Po
-module.so: module.c
-	$(CC) -c module.c -MT module.o -MD -MP -MF .deps/module.Tpo -fPIC $(AM_CFLAGS)
-	$(CC) -o module.so -shared module.o
-clean-local:
-	rm -f module.so
+noinst_LTLIBRARIES = module.la
+module_la_SOURCES = module.c
+module_la_LDFLAGS = -module -avoid-version -no-undefined
--- origsrc/uprof/tests/dlopen.c	2010-12-30 17:08:50.000000000 +0900
+++ src/uprof/tests/dlopen.c	2010-12-30 17:21:54.365735000 +0900
@@ -21,7 +21,11 @@ load_and_run_module ()
   void *handle;
   void (*run)(void);
 
+#if defined(__CYGWIN__)
+  handle = dlopen ("./module.dll", RTLD_LAZY);
+#else
   handle = dlopen ("./module.so", RTLD_LAZY);
+#endif
   if (!handle)
     g_critical ("Failed to load test module: %s", dlerror ());
 
--- origsrc/uprof/uprof/Makefile.am	2010-12-30 17:08:50.000000000 +0900
+++ src/uprof/uprof/Makefile.am	2010-12-30 17:09:55.882607000 +0900
@@ -8,7 +8,7 @@ libuprof_@UPROF_MAJOR_VERSION@_@UPROF_MI
 
 libuprof_@UPROF_MAJOR_VERSION@_@UPROF_MINOR_VERSION@_la_LIBADD = -lrt
 libuprof_@UPROF_MAJOR_VERSION@_@UPROF_MINOR_VERSION@_la_LDFLAGS = \
-	-export-dynamic \
+	-export-dynamic -no-undefined \
 	@UPROF_DEP_LIBS@
 libuprof_@UPROF_MAJOR_VERSION@_@UPROF_MINOR_VERSION@_la_CFLAGS = \
 	@EXTRA_CFLAGS@ \
