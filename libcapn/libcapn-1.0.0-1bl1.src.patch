--- origsrc/libcapn/CMakeLists.txt	2014-02-28 18:45:57.000000000 +0900
+++ src/libcapn/CMakeLists.txt	2014-05-25 22:59:39.456513100 +0900
@@ -65,20 +65,6 @@ ENDIF(CMAKE_SIZEOF_VOID_P EQUAL 8)
 
 INCLUDE(ExternalProject)
 
-ExternalProject_Add(
-    jansson
-    SOURCE_DIR "${CMAKE_CURRENT_SOURCE_DIR}/jansson"
-    #GIT_REPOSITORY git://github.com/akheron/jansson.git
-    BINARY_DIR "${CMAKE_CURRENT_SOURCE_DIR}/jansson"
-    INSTALL_DIR "${CMAKE_CURRENT_SOURCE_DIR}/jansson"
-    CMAKE_COMMAND cmake .
-    BUILD_COMMAND ""
-    INSTALL_COMMAND ""
-)
-
-INCLUDE_DIRECTORIES ("${CMAKE_CURRENT_SOURCE_DIR}/jansson")
-INCLUDE_DIRECTORIES ("${CMAKE_CURRENT_SOURCE_DIR}/jansson/include")
-
 CONFIGURE_FILE("${CMAKE_CURRENT_SOURCE_DIR}/src/platform.h.cmake" "${PROJECT_BINARY_DIR}/src/platform.h")
 CONFIGURE_FILE("${CMAKE_CURRENT_SOURCE_DIR}/src/version.h.cmake" "${PROJECT_BINARY_DIR}/src/version.h")
 
@@ -101,12 +87,12 @@ IF(UNIX)
 	SET(CAPN_INSTALL_PATH_INCLUDES "${CMAKE_INSTALL_PREFIX}/include/${CAPN_LIB_NAME}"  CACHE PATH "")
     ENDIF()    
 
-    IF(NOT DEFINED CAPN_INSTALL_PATH_LIB)
+    IF(NOT DEFINED CAPN_INSTALL_PATH_BIN)
 	SET(CAPN_INSTALL_PATH_BIN "${CMAKE_INSTALL_PREFIX}/bin"  CACHE PATH "")
     ENDIF()
 
     IF(NOT DEFINED CAPN_INSTALL_PATH_PKGCONFIG)
-	SET(CAPN_INSTALL_PATH_PKGCONFIG "${CMAKE_INSTALL_PREFIX}/share/pkgconfig"  CACHE PATH "")
+	SET(CAPN_INSTALL_PATH_PKGCONFIG "${CMAKE_INSTALL_PREFIX}/lib/pkgconfig"  CACHE PATH "")
     ENDIF()
 
     IF(NOT DEFINED CAPN_INSTALL_PATH_SYSCONFIG)
@@ -142,12 +128,9 @@ IF(UNIX)
 
 ENDIF(UNIX)
 
-FILE (GLOB JANSSON_SOURCE_FILES jansson/src/*.c)
-
 SET(CAPN_SOURCE_FILES
     src/apn.c
     src/apn_strings.c
-    ${JANSSON_SOURCE_FILES}
 )
 
 SET(CAPN_PUBLIC_HEADER_FILES
@@ -156,7 +139,7 @@ SET(CAPN_PUBLIC_HEADER_FILES
     ${PROJECT_BINARY_DIR}/src/version.h 
 )
 
-IF(DEFINED WIN32)
+IF(WIN32)
     SET(CAPN_INSTALL_DIR ${PROJECT_BINARY_DIR}/capn-bin)
     SET(CAPN_INSTALL_PATH_LIB ${CAPN_INSTALL_DIR}/lib)
     SET(CAPN_INSTALL_PATH_INCLUDES ${CAPN_INSTALL_DIR}/include)
@@ -195,20 +178,20 @@ IF(DEFINED WIN32)
           ${CMAKE_CURRENT_SOURCE_DIR}/LICENSE
           DESTINATION ${CAPN_INSTALL_DIR})
     	ADD_CUSTOM_TARGET(zip COMMAND ${PROJECT_BINARY_DIR}/win/createpkg.bat)
-ENDIF(DEFINED WIN32)
+ENDIF(WIN32)
 
 ADD_LIBRARY(${CAPN_LIB_NAME} SHARED ${CAPN_SOURCE_FILES})
 TARGET_LINK_LIBRARIES(${CAPN_LIB_NAME} ${OPENSSL_LIBRARIES})
 
-IF(DEFINED WIN32)
+IF(WIN32)
 TARGET_LINK_LIBRARIES(${CAPN_LIB_NAME} Ws2_32.lib)
-ENDIF(DEFINED WIN32)
+ENDIF(WIN32)
 
 SET_TARGET_PROPERTIES(${CAPN_LIB_NAME} PROPERTIES
     VERSION ${CAPN_VERSION} SOVERSION ${CAPN_VERSION_MAJOR}
     CLEAN_DIRECT_OUTPUT 1	# for cmake 2.6.x and lower
 )
-ADD_DEPENDENCIES(${CAPN_LIB_NAME} jansson)
+TARGET_LINK_LIBRARIES(${CAPN_LIB_NAME} jansson)
 
 INSTALL(TARGETS ${CAPN_LIB_NAME}
          RUNTIME DESTINATION ${CAPN_INSTALL_PATH_BIN}
