--- origsrc/augeas-0.10.0/src/Makefile.am	2011-12-01 08:21:02.000000000 +0900
+++ src/augeas-0.10.0/src/Makefile.am	2012-05-17 21:52:29.295475300 +0900
@@ -1,5 +1,5 @@
 GNULIB= ../gnulib/lib/libgnu.la
-GNULIB_CFLAGS= -I $(top_srcdir)/gnulib/lib
+GNULIB_CFLAGS= -I$(top_builddir)/gnulib/lib -I$(top_srcdir)/gnulib/lib
 
 AM_CFLAGS = @AUGEAS_CFLAGS@ @WARN_CFLAGS@ $(GNULIB_CFLAGS) $(LIBXML_CFLAGS)
 
@@ -34,7 +34,7 @@ else
 endif
 
 libaugeas_la_LDFLAGS = $(AUGEAS_VERSION_SCRIPT) \
-    -version-info $(LIBAUGEAS_VERSION_INFO)
+    -version-info $(LIBAUGEAS_VERSION_INFO) -no-undefined
 libaugeas_la_LIBADD = liblexer.la libfa.la $(LIB_SELINUX) $(LIBXML_LIBS) $(GNULIB)
 
 augtool_SOURCES = augtool.c
@@ -45,7 +45,7 @@ augparse_LDADD = libaugeas.la $(LIBXML_L
 
 libfa_la_SOURCES = fa.c fa.h hash.c hash.h memory.c memory.h ref.h ref.c
 libfa_la_LIBADD = $(LIB_SELINUX) $(GNULIB)
-libfa_la_LDFLAGS = $(FA_VERSION_SCRIPT) -version-info $(LIBFA_VERSION_INFO)
+libfa_la_LDFLAGS = $(FA_VERSION_SCRIPT) -version-info $(LIBFA_VERSION_INFO) -no-undefined
 
 liblexer_la_SOURCES = lexer.l
 liblexer_la_CFLAGS = $(AM_CFLAGS) -Wno-error
--- origsrc/augeas-0.10.0/src/regexp.c	2011-12-02 08:04:37.000000000 +0900
+++ src/augeas-0.10.0/src/regexp.c	2012-05-17 21:50:26.386932500 +0900
@@ -50,7 +50,7 @@ char *regexp_escape(const struct regexp
     ret = fa_restrict_alphabet(r->pattern->str, strlen(r->pattern->str),
                                &nre, &nre_len, 2, 1);
     if (ret == 0) {
-        pat = escape(nre, nre_len);
+        pat = escape(nre, nre_len, NULL);
         free(nre);
     }
 #endif
