--- origsrc/libmnetutil/Makefile.am	2010-11-20 16:19:07.000000000 +0900
+++ src/libmnetutil/Makefile.am	2010-11-20 17:09:52.599749600 +0900
@@ -1,17 +1,17 @@
 pkgconfigdir = $(libdir)/pkgconfig
 
-SUBDIRS = udns win32 . examples include m4 tests debian
+SUBDIRS = win32 . examples include m4 tests debian
 DIST_SUBDIRS = $(SUBDIRS)
 EXTRA_DIST = libmnetutil.spec
 
-AM_CPPFLAGS = $(MINISIP_CFLAGS) -I$(srcdir)/include -I$(srcdir)/udns/source
+AM_CPPFLAGS = $(MINISIP_CFLAGS) -I$(srcdir)/include
 
 pkgconfig_DATA = libmnetutil.pc
 
 lib_LTLIBRARIES = libmnetutil.la
 # libmnetutil_la_CPPFLAGS = 
 libmnetutil_la_LDFLAGS = $(MINISIP_LIBRARY_LDFLAGS)
-libmnetutil_la_LIBADD = udns/libudns.la  $(LTLIBOBJS) $(MINISIP_LIBS) $(LDAP_LIBS)
+libmnetutil_la_LIBADD = @UDNS_LIBS@ $(LTLIBOBJS) $(MINISIP_LIBS) $(LDAP_LIBS)
 libmnetutil_la_DEPENDENCIES = $(LTLIBOBJS)
 
 libmnetutil_la_SOURCES = $(mnetutil_src)
@@ -74,7 +74,7 @@ mnetutil_src = \
 		    source/DirectorySetItem.cxx
 
 # maintainer rules
-ACLOCAL_AMFLAGS = -I m4 ${ACLOCAL_FLAGS}
+ACLOCAL_AMFLAGS = -I m4
 MAINTAINERCLEANFILES = \
 		$(srcdir)/Makefile.in \
 		$(srcdir)/aclocal.m4 \
--- origsrc/libmnetutil/configure.ac	2010-11-20 16:19:07.000000000 +0900
+++ src/libmnetutil/configure.ac	2010-11-20 17:44:23.617727200 +0900
@@ -15,7 +15,6 @@ AM_MINISIP_PACKAGE_INIT
 AM_CONFIG_HEADER(include/compilation_config.h)
 
 AM_MINISIP_LIBTOOL_EXTRAS
-AC_PROG_LIBTOOL
 AC_PROG_AWK
 
 AM_MINISIP_ENABLE_DEBUG
@@ -23,7 +22,10 @@ AM_MINISIP_ENABLE_TEST_SUITE
 AM_MINISIP_ENABLE_IPV6
 
 dnl networking headers
-AC_CHECK_HEADERS([netinet/in.h ws2tcpip.h])
+AC_CHECK_HEADERS([netinet/in.h])
+case "$host_os" in
+  cygwin*) AC_CHECK_HEADERS([ws2tcpip.h]) ;;
+esac
 AC_CHECK_HEADERS([ifaddrs.h netdb.h sys/socket.h])
 AM_MINISIP_CHECK_IPV6
 
@@ -87,6 +89,8 @@ fi
 AM_MINISIP_CHECK_LIBMUTIL([0.8.0])
 AM_MINISIP_CHECK_COMPLETE
 
+AC_CHECK_LIB([udns], [dns_init], [UDNS_LIBS=-ludns AC_SUBST(UDNS_LIBS)])
+
 AC_CHECK_FUNCS([poll])
 AC_REPLACE_FUNCS([inet_aton inet_pton inet_ntop])
 
@@ -105,7 +109,6 @@ AC_CONFIG_FILES([
 		include/Makefile 
 		m4/Makefile 
 		tests/Makefile
-		udns/Makefile
 		debian/Makefile
 		win32/Makefile 
 		win32/libmnetutil-res.rc
--- origsrc/libmnetutil/source/IP4Address.cxx	2010-11-20 16:19:05.000000000 +0900
+++ src/libmnetutil/source/IP4Address.cxx	2010-11-20 18:37:04.853360800 +0900
@@ -121,12 +121,13 @@ IP4Address::IP4Address(string addr){
 
 		//unsigned char *ip;
 		
-#ifndef WIN32
+#if !defined(WIN32) && !defined(__CYGWIN__)
 		struct hostent *hp= gethostbyname2(ipaddr.c_str(), AF_INET);	
 #else
 		struct hostent *hp= gethostbyname(ipaddr.c_str());	
 //		struct hostent *hp= gethostbyaddr(ipaddr.c_str(), 4, AF_INET);	
-
+#endif
+#if defined(WIN32)
 		if (WSAGetLastError() != 0) {
 			if (WSAGetLastError() == 11001)
 				throw HostNotFound( addr );
@@ -196,7 +197,7 @@ void IP4Address::connect(Socket &socket,
 		ip = (unsigned char *)&ip_data;
 	}else{
 	
-#ifndef WIN32
+#if !defined(WIN32) && !defined(__CYGWIN__)
 		struct hostent *hp= gethostbyname2(ipaddr.c_str(), AF_INET);	
 #else
 		struct hostent *hp= gethostbyname(ipaddr.c_str());	
--- origsrc/libmnetutil/source/IP6Address.cxx	2010-11-20 16:19:05.000000000 +0900
+++ src/libmnetutil/source/IP6Address.cxx	2010-11-20 18:38:20.131605600 +0900
@@ -182,7 +182,7 @@ IP6Address::IP6Address(string addr){
 	}
 
 #endif // !HAVE_GETADDRINFO
-#ifndef WIN32
+#if !defined(WIN32) && !defined(__CYGWIN__)
 	hostent *hp= gethostbyname2(addr.c_str(), AF_INET6);	
 #else
 	hostent *hp= gethostbyname(addr.c_str());	
--- origsrc/libmnetutil/source/init.cxx	2010-11-20 16:19:05.000000000 +0900
+++ src/libmnetutil/source/init.cxx	2010-11-20 18:30:29.845367200 +0900
@@ -34,7 +34,7 @@ LIBMNETUTIL_API void libmnetutilInit()
 	if( g_initialized++ > 0 )
 		return;
 
-	if( dns_init(0) < 0 ) {
+	if( dns_init(0, 0) < 0 ) {
 		g_initialized--;
 		throw Exception( "libmnetutil udns initialization failed" );
 	}
