--- origsrc/libupnp-1.6.6/configure.ac	2008-04-25 20:41:16.000000000 +0900
+++ src/libupnp-1.6.6/configure.ac	2010-08-08 15:24:34.185921300 +0900
@@ -281,10 +281,10 @@ AC_MSG_RESULT($docdir)
 #
 AC_PROG_CC
 AM_PROG_CC_C_O
-AC_PROG_LIBTOOL
 AC_PROG_INSTALL
 AC_PROG_MAKE_SET
 AC_PROG_EGREP
+LT_INIT(win32-dll)
 
 #
 # Default compilation flags
--- origsrc/libupnp-1.6.6/ixml/Makefile.am	2008-02-10 10:55:39.000000000 +0900
+++ src/libupnp-1.6.6/ixml/Makefile.am	2010-08-08 15:25:17.920296300 +0900
@@ -20,7 +20,7 @@ endif
 
 lib_LTLIBRARIES		= libixml.la
 
-libixml_la_LDFLAGS	= -version-info $(LT_VERSION_IXML) \
+libixml_la_LDFLAGS	= -version-info $(LT_VERSION_IXML) -no-undefined \
 			  -export-symbols-regex '^ixml.*'
 
 libixml_la_SOURCES	= \
--- origsrc/libupnp-1.6.6/threadutil/Makefile.am	2008-02-10 10:55:38.000000000 +0900
+++ src/libupnp-1.6.6/threadutil/Makefile.am	2010-08-08 15:25:39.076546300 +0900
@@ -16,7 +16,7 @@ endif
 
 lib_LTLIBRARIES		= libthreadutil.la
 
-libthreadutil_la_LDFLAGS = -version-info $(LT_VERSION_THREADUTIL)
+libthreadutil_la_LDFLAGS = -version-info $(LT_VERSION_THREADUTIL) -no-undefined
 
 libthreadutil_la_SOURCES = \
 			src/FreeList.c src/LinkedList.c \
--- origsrc/libupnp-1.6.6/threadutil/src/ThreadPool.c	2008-04-11 01:03:04.000000000 +0900
+++ src/libupnp-1.6.6/threadutil/src/ThreadPool.c	2010-08-08 16:01:22.623421300 +0900
@@ -389,7 +389,7 @@ static void SetSeed()
 	gettimeofday(&t, NULL);
 #if defined(WIN32)
  	srand( ( unsigned int )t.tv_usec + (unsigned int)ithread_get_current_thread_id().p );
-#elif defined(__FreeBSD__) || defined(__OSX__) || defined(__APPLE__)
+#elif defined(__FreeBSD__) || defined(__OSX__) || defined(__APPLE__) || defined(__CYGWIN__)
  	srand( ( unsigned int )t.tv_usec + (unsigned int)ithread_get_current_thread_id() );
 #elif defined(__linux__) || defined(__sun)
  	srand( ( unsigned int )t.tv_usec + ithread_get_current_thread_id() );
--- origsrc/libupnp-1.6.6/upnp/Makefile.am	2008-02-10 10:55:34.000000000 +0900
+++ src/libupnp-1.6.6/upnp/Makefile.am	2010-08-08 15:26:09.670296300 +0900
@@ -33,7 +33,7 @@ lib_LTLIBRARIES = libupnp.la
 libupnp_la_CPPFLAGS = $(AM_CPPFLAGS) -I$(srcdir)/src/inc 
 
 libupnp_la_LDFLAGS = \
-	-version-info $(LT_VERSION_UPNP) \
+	-version-info $(LT_VERSION_UPNP) -no-undefined \
 	-export-symbols-regex '^Upnp.*' \
 	$(top_builddir)/threadutil/libthreadutil.la \
 	$(top_builddir)/ixml/libixml.la
