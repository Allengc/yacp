--- origsrc/libupnp-1.6.9/configure.ac	2010-11-07 12:33:18.000000000 +0900
+++ src/libupnp-1.6.9/configure.ac	2010-12-11 12:41:16.972679800 +0900
@@ -341,7 +341,7 @@ AC_MSG_RESULT($docdir)
 #
 AC_PROG_CC
 AM_PROG_CC_C_O
-AC_PROG_LIBTOOL
+LT_INIT(win32-dll)
 AC_PROG_INSTALL
 AC_PROG_MAKE_SET
 AC_PROG_EGREP
@@ -529,8 +529,12 @@ AC_OUTPUT
 #
 # Files copied for windows compilation.
 #
+case "$host_os" in
+  cygwin*) ;;
+  *)
 echo "configure: copying \"autoconfig.h\"          to \"build/inc/autoconfig.h\""
 cp autoconfig.h build/inc/autoconfig.h
 echo "configure: copying \"upnp/inc/upnpconfig.h\" to \"build/inc/upnpconfig.h\""
 cp upnp/inc/upnpconfig.h build/inc/upnpconfig.h
-
+  ;;
+esac
--- origsrc/libupnp-1.6.9/ixml/Makefile.am	2010-10-21 21:01:30.000000000 +0900
+++ src/libupnp-1.6.9/ixml/Makefile.am	2010-12-11 13:09:24.288921400 +0900
@@ -7,7 +7,7 @@
 
 SUBDIRS 		= doc
 
-AM_CPPFLAGS		= -I$(srcdir)/inc -I$(srcdir)/src/inc
+AM_CPPFLAGS		= -I$(srcdir)/inc -I$(srcdir)/src/inc -I$(top_srcdir)/upnp/inc
 AM_CFLAGS		= 
 
 LDADD			= libixml.la
@@ -20,7 +20,7 @@ endif
 
 lib_LTLIBRARIES		= libixml.la
 
-libixml_la_LDFLAGS	= -version-info $(LT_VERSION_IXML) \
+libixml_la_LDFLAGS	= -version-info $(LT_VERSION_IXML) -no-undefined \
 			  -export-symbols-regex '^ixml.*'
 
 libixml_la_SOURCES	= \
--- origsrc/libupnp-1.6.9/threadutil/Makefile.am	2010-10-21 21:01:30.000000000 +0900
+++ src/libupnp-1.6.9/threadutil/Makefile.am	2010-12-11 13:14:56.076007800 +0900
@@ -5,7 +5,7 @@
 # (C) Copyright 2005 Rémi Turboult <r3mi@users.sourceforge.net>
 #
 
-AM_CPPFLAGS		= -I$(srcdir)/inc -I$(srcdir)/src/inc
+AM_CPPFLAGS		= -I$(srcdir)/inc -I$(srcdir)/src/inc -I$(top_srcdir)/upnp/inc
 
 if ENABLE_DEBUG
     AM_CPPFLAGS		+= -DDEBUG -DSTATS
@@ -16,7 +16,7 @@ endif
 
 lib_LTLIBRARIES		= libthreadutil.la
 
-libthreadutil_la_LDFLAGS = -version-info $(LT_VERSION_THREADUTIL)
+libthreadutil_la_LDFLAGS = -version-info $(LT_VERSION_THREADUTIL) -no-undefined
 
 libthreadutil_la_SOURCES = \
 			src/FreeList.c src/LinkedList.c \
--- origsrc/libupnp-1.6.9/upnp/Makefile.am	2010-11-07 06:43:40.000000000 +0900
+++ src/libupnp-1.6.9/upnp/Makefile.am	2010-12-11 11:56:06.507886900 +0900
@@ -36,7 +36,7 @@ lib_LTLIBRARIES = libupnp.la
 libupnp_la_CPPFLAGS = $(AM_CPPFLAGS) -I$(srcdir)/src/inc 
 
 libupnp_la_LDFLAGS = \
-	-version-info $(LT_VERSION_UPNP) \
+	-version-info $(LT_VERSION_UPNP) -no-undefined \
 	-export-symbols-regex '^Upnp.*' \
 	$(top_builddir)/threadutil/libthreadutil.la \
 	$(top_builddir)/ixml/libixml.la
