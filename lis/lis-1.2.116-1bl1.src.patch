--- origsrc/lis-1.2.116/src/Makefile.am	2012-08-02 19:40:27.000000000 +0900
+++ src/lis-1.2.116/src/Makefile.am	2012-09-30 00:46:35.672000000 +0900
@@ -18,11 +18,15 @@ liblis@LIBSUFFIX@_la_LIBADD = matrix/lib
                    system/libsystem.la \
                    precision/libprecision.la 
 if ENABLE_SAAMG
-  liblis@LIBSUFFIX@_la_LIBADD += fortran/libfortran.la
+  liblis@LIBSUFFIX@_la_LIBADD += fortran/libfortran.la -lgfortran
   liblis@LIBSUFFIX@_la_LIBADD += fortran/amg/libsaamg.la
 else
 if ENABLE_FORTRAN
-  liblis@LIBSUFFIX@_la_LIBADD += fortran/libfortran.la
+  liblis@LIBSUFFIX@_la_LIBADD += fortran/libfortran.la -lgfortran
 endif
 endif
+if ENABLE_OMP
+  liblis@LIBSUFFIX@_la_LIBADD += -lgomp
+endif
 liblis@LIBSUFFIX@_la_SOURCES = 
+liblis@LIBSUFFIX@_la_LDFLAGS = -no-undefined
--- origsrc/lis-1.2.116/test/test.sh	2012-08-31 10:24:39.000000000 +0900
+++ src/lis-1.2.116/test/test.sh	2012-09-30 00:52:19.744265600 +0900
@@ -25,27 +25,27 @@ fi
 
 echo ' '
 echo 'checking linear solvers...'
-$MPIRUN $srcdir/test1 $srcdir/testmat.mtx 0 /dev/null /dev/null -omp_num_threads $OMPNUM
+$MPIRUN $top_builddir/test/test1 $srcdir/testmat.mtx 0 /dev/null /dev/null -omp_num_threads $OMPNUM
 
 echo 'checking eigensolvers...'
-$MPIRUN $srcdir/etest1 $srcdir/testmat.mtx /dev/null /dev/null -omp_num_threads $OMPNUM
+$MPIRUN $top_builddir/test/etest1 $srcdir/testmat.mtx /dev/null /dev/null -omp_num_threads $OMPNUM
 
 if test "$enable_fortran" = "yes"; then
   echo 'checking Fortran interface...'
   echo ' '
-  $MPIRUN $srcdir/test4f -omp_num_threads $OMPNUM
+  $MPIRUN $top_builddir/test/test4f -omp_num_threads $OMPNUM
   echo ' '
 fi
 
 if test "$enable_quad" = "yes"; then
   echo 'checking quad precision operations...'
-  $MPIRUN $srcdir/test5 200 2.0 -f double -omp_num_threads $OMPNUM
-  $MPIRUN $srcdir/test5 200 2.0 -f quad -omp_num_threads $OMPNUM
+  $MPIRUN $top_builddir/test/test5 200 2.0 -f double -omp_num_threads $OMPNUM
+  $MPIRUN $top_builddir/test/test5 200 2.0 -f quad -omp_num_threads $OMPNUM
 fi
 
 OMPNUM=1
 if test "$enable_saamg" = "yes"; then
   echo 'checking SAAMG preconditioner...'
-  $MPIRUN $srcdir/test2 10 10 1 /dev/null /dev/null -i cg -p saamg -omp_num_threads $OMPNUM
+  $MPIRUN $top_builddir/test/test2 10 10 1 /dev/null /dev/null -i cg -p saamg -omp_num_threads $OMPNUM
 fi
 
