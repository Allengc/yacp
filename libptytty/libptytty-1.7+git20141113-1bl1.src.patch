--- origsrc/libptytty/Makefile.am	2015-02-17 23:09:21.000000000 +0900
+++ src/libptytty/Makefile.am	2015-02-17 23:36:04.500250000 +0900
@@ -11,6 +11,7 @@ include_HEADERS = src/libptytty.h
 lib_LTLIBRARIES = libptytty.la
 
 libptytty_la_SOURCES = src/c-api.C src/fdpass.C src/logging.C src/proxy.C src/ptytty.C
+libptytty_la_LDFLAGS = -no-undefined
 
 noinst_PROGRAMS = c-sample
 c_sample_SOURCES = eg/c-sample.c
@@ -18,6 +19,14 @@ c_sample_LDADD = libptytty.la
 c_sample_CPPFLAGS = -I$(top_srcdir)/src
 c_sample_LINK = $(CXXLINK)
 
+pkgconfigdir = $(libdir)/pkgconfig
+pkgconfig_DATA = libptytty.pc
+
+aclocaldir = $(datadir)/aclocal
+aclocal_DATA = ptytty.m4
+
+TESTS = c-sample
+
 $(srcdir)/doc/libptytty.3: $(srcdir)/doc/libptytty.3.pod
 	pod2man -n libptytty -r "$(VERSION)" -q\" -c LIBPTYTTY -s3 <$< >$@
 
--- origsrc/libptytty/configure.ac	2015-02-17 23:09:21.000000000 +0900
+++ src/libptytty/configure.ac	2015-02-17 23:34:20.176031300 +0900
@@ -2,8 +2,8 @@ dnl#
 dnl# Process this file with autoconf to produce a configure script.
 dnl#
 
-AC_INIT
-AM_INIT_AUTOMAKE(libptytty,1.7)
+AC_INIT([libptytty], [1.7])
+AM_INIT_AUTOMAKE
 AC_CONFIG_HEADER(config.h:config.h.in)
 
 AC_CANONICAL_HOST
@@ -22,5 +22,5 @@ UTMP_CHECK
 
 SCM_RIGHTS_CHECK
 
-AC_CONFIG_FILES([Makefile])
+AC_CONFIG_FILES([Makefile libptytty.pc])
 AC_OUTPUT
--- origsrc/libptytty/doc/libptytty.3	2015-02-17 23:09:21.000000000 +0900
+++ src/libptytty/doc/libptytty.3	2015-02-17 23:11:47.194586000 +0900
@@ -1,4 +1,4 @@
-.\" Automatically generated by Pod::Man 2.23 (Pod::Simple 3.14)
+.\" Automatically generated by Pod::Man 2.25 (Pod::Simple 3.16)
 .\"
 .\" Standard preamble:
 .\" ========================================================================
@@ -124,7 +124,7 @@
 .\" ========================================================================
 .\"
 .IX Title "libptytty 3"
-.TH libptytty 3 "2012-01-21" "1.6" "LIBPTYTTY"
+.TH libptytty 3 "2015-02-17" "1.7" "LIBPTYTTY"
 .\" For nroff, turn off justification.  Always turn off hyphenation; it makes
 .\" way too many mistakes in technical documents.
 .if n .ad l
--- origsrc/libptytty/libptytty.pc.in	1970-01-01 09:00:00.000000000 +0900
+++ src/libptytty/libptytty.pc.in	2015-02-17 23:24:45.332281300 +0900
@@ -0,0 +1,10 @@
+prefix=@prefix@
+exec_prefix=@exec_prefix@
+libdir=@libdir@
+includedir=@includedir@
+
+Name: libptytty
+Description: OS independent and secure pty/tty and utmp/wtmp/lastlog handling
+Version: @VERSION@
+Libs: -L${libdir} -lptytty
+Cflags: -I${includedir}
--- origsrc/libptytty/src/logging.C	2015-02-17 23:09:21.000000000 +0900
+++ src/libptytty/src/logging.C	2015-02-17 23:14:16.563726600 +0900
@@ -344,7 +344,7 @@ ptytty_unix::log_session (bool login, co
       update_wtmp (WTMP_FILE, &ut);
 #  endif
 # endif
-# if defined(HAVE_STRUCT_UTMPX) && defined(HAVE_UPDWTMPX)
+# if defined(HAVE_STRUCT_UTMPX) && defined(HAVE_UPDWTMPX) && !defined(__CYGWIN__)
       updwtmpx (WTMPX_FILE, &utx);
 # endif
     }
