--- origsrc/libvirt-1.2.14/tests/Makefile.am	2015-03-31 09:33:16.000000000 +0900
+++ src/libvirt-1.2.14/tests/Makefile.am	2015-04-15 01:04:52.927916500 +0900
@@ -549,7 +549,7 @@ qemuxml2argvtest_LDADD = $(qemu_LDADDS)
 qemuxml2argvmock_la_SOURCES = \
 	qemuxml2argvmock.c
 qemuxml2argvmock_la_CFLAGS = $(AM_CFLAGS)
-qemuxml2argvmock_la_LDFLAGS = -module -avoid-version \
+qemuxml2argvmock_la_LDFLAGS = -no-undefined -module -avoid-version \
 	-rpath /evil/libtool/hack/to/force/shared/lib/creation
 
 qemuxml2xmltest_SOURCES = \
@@ -718,7 +718,7 @@ if WITH_BHYVE
 bhyvexml2argvmock_la_SOURCES = \
 	bhyvexml2argvmock.c
 bhyvexml2argvmock_la_CFLAGS = $(AM_CFLAGS)
-bhyvexml2argvmock_la_LDFLAGS = -module -avoid-version \
+bhyvexml2argvmock_la_LDFLAGS = -no-undefined -module -avoid-version \
 			-rpath /evil/libtool/hack/to/force/shared/lib/creation
 
 bhyve_LDADDS = ../src/libvirt_driver_bhyve_impl.la
@@ -917,7 +917,7 @@ virnetserverclienttest_LDADD = $(LDADDS)
 virnetserverclientmock_la_SOURCES = \
 	virnetserverclientmock.c
 virnetserverclientmock_la_CFLAGS = $(AM_CFLAGS)
-virnetserverclientmock_la_LDFLAGS = -module -avoid-version \
+virnetserverclientmock_la_LDFLAGS = -no-undefined -module -avoid-version \
         -rpath /evil/libtool/hack/to/force/shared/lib/creation
 
 if WITH_GNUTLS
@@ -996,7 +996,7 @@ virportallocatortest_LDADD = $(LDADDS)
 libvirportallocatormock_la_SOURCES = \
 	virportallocatortest.c
 libvirportallocatormock_la_CFLAGS = $(AM_CFLAGS) -DMOCK_HELPER=1
-libvirportallocatormock_la_LDFLAGS = -module -avoid-version \
+libvirportallocatormock_la_LDFLAGS = -no-undefined -module -avoid-version \
         -rpath /evil/libtool/hack/to/force/shared/lib/creation
 
 vircgrouptest_SOURCES = \
@@ -1006,7 +1006,7 @@ vircgrouptest_LDADD = $(LDADDS)
 vircgroupmock_la_SOURCES = \
 	vircgroupmock.c
 vircgroupmock_la_CFLAGS = $(AM_CFLAGS)
-vircgroupmock_la_LDFLAGS = -module -avoid-version \
+vircgroupmock_la_LDFLAGS = -no-undefined -module -avoid-version \
         -rpath /evil/libtool/hack/to/force/shared/lib/creation
 
 vircryptotest_SOURCES = \
@@ -1026,7 +1026,7 @@ virpcimock_la_SOURCES = \
 virpcimock_la_CFLAGS = $(AM_CFLAGS)
 virpcimock_la_LIBADD = $(GNULIB_LIBS) \
 					   ../src/libvirt.la
-virpcimock_la_LDFLAGS = -module -avoid-version \
+virpcimock_la_LDFLAGS = -no-undefined -module -avoid-version \
         -rpath /evil/libtool/hack/to/force/shared/lib/creation
 
 if WITH_LINUX
@@ -1040,13 +1040,13 @@ virnetdevbandwidthtest_LDADD = $(LDADDS)
 
 virusbmock_la_SOURCES = virusbmock.c
 virusbmock_la_CFLAGS = $(AM_CFLAGS)
-virusbmock_la_LDFLAGS = -module -avoid-version \
+virusbmock_la_LDFLAGS = -no-undefined -module -avoid-version \
         -rpath /evil/libtool/hack/to/force/shared/lib/creation
 
 virnetdevbandwidthmock_la_SOURCES = \
 	virnetdevbandwidthmock.c
 virnetdevbandwidthmock_la_CFLAGS = $(AM_CFLAGS)
-virnetdevbandwidthmock_la_LDFLAGS = -module -avoid-version \
+virnetdevbandwidthmock_la_LDFLAGS = -no-undefined -module -avoid-version \
         -rpath /evil/libtool/hack/to/force/shared/lib/creation
 
 else ! WITH_LINUX
@@ -1063,7 +1063,7 @@ virdbustest_LDADD = $(LDADDS) $(DBUS_LIB
 virmockdbus_la_SOURCES = \
 	virmockdbus.c
 virmockdbus_la_CFLAGS = $(AM_CFLAGS) $(DBUS_CFLAGS)
-virmockdbus_la_LDFLAGS = -module -avoid-version \
+virmockdbus_la_LDFLAGS = -no-undefined -module -avoid-version \
         -rpath /evil/libtool/hack/to/force/shared/lib/creation
 
 virpolkittest_SOURCES = \
@@ -1110,7 +1110,7 @@ endif ! WITH_TESTS
 
 libsecurityselinuxhelper_la_SOURCES = \
 	securityselinuxhelper.c
-libsecurityselinuxhelper_la_LDFLAGS = -module -avoid-version \
+libsecurityselinuxhelper_la_LDFLAGS = -no-undefined -module -avoid-version \
         -rpath /evil/libtool/hack/to/force/shared/lib/creation
 
 securityselinuxtest_SOURCES = \
@@ -1183,7 +1183,7 @@ endif WITH_LIBVIRTD
 
 libshunload_la_SOURCES = shunloadhelper.c
 libshunload_la_LIBADD = ../src/libvirt.la
-libshunload_la_LDFLAGS = -module -avoid-version \
+libshunload_la_LDFLAGS = -no-undefined -module -avoid-version \
 	-rpath /evil/libtool/hack/to/force/shared/lib/creation
 
 shunloadtest_SOURCES = \
