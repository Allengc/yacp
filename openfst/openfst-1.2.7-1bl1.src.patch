--- origsrc/openfst-1.2.7/configure.ac	2011-03-12 08:54:41.000000000 +0900
+++ src/openfst-1.2.7/configure.ac	2011-05-28 16:20:21.211505700 +0900
@@ -3,7 +3,7 @@ AM_INIT_AUTOMAKE([foreign nostdinc -Wall
 
 AC_PROG_CXX
 AC_DISABLE_STATIC
-AC_PROG_LIBTOOL
+LT_INIT
 
 AC_CONFIG_HEADERS([config.h src/include/fst/config.h])
 AC_CONFIG_SRCDIR([src/lib/fst.cc])
--- origsrc/openfst-1.2.7/src/extensions/compact/Makefile.am	2011-03-12 08:54:41.000000000 +0900
+++ src/openfst-1.2.7/src/extensions/compact/Makefile.am	2011-05-28 22:30:35.250648000 +0900
@@ -5,49 +5,65 @@ libfstdir = @libfstdir@
 libfst_LTLIBRARIES = libfstcompact.la compact8_acceptor-fst.la compact8_string-fst.la compact8_unweighted-fst.la compact8_unweighted_acceptor-fst.la compact8_weighted_string-fst.la compact16_acceptor-fst.la compact16_string-fst.la compact16_unweighted-fst.la compact16_unweighted_acceptor-fst.la compact16_weighted_string-fst.la compact64_acceptor-fst.la compact64_string-fst.la compact64_unweighted-fst.la compact64_unweighted_acceptor-fst.la compact64_weighted_string-fst.la
 
 libfstcompact_la_SOURCES = compact8_acceptor-fst.cc compact8_string-fst.cc compact8_unweighted-fst.cc compact8_unweighted_acceptor-fst.cc compact8_weighted_string-fst.cc compact16_acceptor-fst.cc compact16_string-fst.cc compact16_unweighted-fst.cc compact16_unweighted_acceptor-fst.cc compact16_weighted_string-fst.cc compact64_acceptor-fst.cc compact64_string-fst.cc compact64_unweighted-fst.cc compact64_unweighted_acceptor-fst.cc compact64_weighted_string-fst.cc
-libfstcompact_la_LDFLAGS = -version-info 0:0:0
+libfstcompact_la_LDFLAGS = -version-info 0:0:0 -no-undefined
+libfstcompact_la_LIBADD = ../../lib/libfst.la
 
 compact8_acceptor_fst_la_SOURCES = compact8_acceptor-fst.cc
-compact8_acceptor_fst_la_LDFLAGS = -module
+compact8_acceptor_fst_la_LDFLAGS = -module -no-undefined -avoid-version
+compact8_acceptor_fst_la_LIBADD = ../../lib/libfst.la
 
 compact8_string_fst_la_SOURCES = compact8_string-fst.cc
-compact8_string_fst_la_LDFLAGS = -module
+compact8_string_fst_la_LDFLAGS = -module -no-undefined -avoid-version
+compact8_string_fst_la_LIBADD = ../../lib/libfst.la
 
 compact8_unweighted_fst_la_SOURCES = compact8_unweighted-fst.cc
-compact8_unweighted_fst_la_LDFLAGS = -module
+compact8_unweighted_fst_la_LDFLAGS = -module -no-undefined -avoid-version
+compact8_unweighted_fst_la_LIBADD = ../../lib/libfst.la
 
 compact8_unweighted_acceptor_fst_la_SOURCES = compact8_unweighted_acceptor-fst.cc
-compact8_unweighted_acceptor_fst_la_LDFLAGS = -module
+compact8_unweighted_acceptor_fst_la_LDFLAGS = -module -no-undefined -avoid-version
+compact8_unweighted_acceptor_fst_la_LIBADD = ../../lib/libfst.la
 
 compact8_weighted_string_fst_la_SOURCES = compact8_weighted_string-fst.cc
-compact8_weighted_string_fst_la_LDFLAGS = -module
+compact8_weighted_string_fst_la_LDFLAGS = -module -no-undefined -avoid-version
+compact8_weighted_string_fst_la_LIBADD = ../../lib/libfst.la
 
 compact16_acceptor_fst_la_SOURCES = compact16_acceptor-fst.cc
-compact16_acceptor_fst_la_LDFLAGS = -module
+compact16_acceptor_fst_la_LDFLAGS = -module -no-undefined -avoid-version
+compact16_acceptor_fst_la_LIBADD = ../../lib/libfst.la
 
 compact16_string_fst_la_SOURCES = compact16_string-fst.cc
-compact16_string_fst_la_LDFLAGS = -module
+compact16_string_fst_la_LDFLAGS = -module -no-undefined -avoid-version
+compact16_string_fst_la_LIBADD = ../../lib/libfst.la
 
 compact16_unweighted_fst_la_SOURCES = compact16_unweighted-fst.cc
-compact16_unweighted_fst_la_LDFLAGS = -module
+compact16_unweighted_fst_la_LDFLAGS = -module -no-undefined -avoid-version
+compact16_unweighted_fst_la_LIBADD = ../../lib/libfst.la
 
 compact16_unweighted_acceptor_fst_la_SOURCES = compact16_unweighted_acceptor-fst.cc
-compact16_unweighted_acceptor_fst_la_LDFLAGS = -module
+compact16_unweighted_acceptor_fst_la_LDFLAGS = -module -no-undefined -avoid-version
+compact16_unweighted_acceptor_fst_la_LIBADD = ../../lib/libfst.la
 
 compact16_weighted_string_fst_la_SOURCES = compact16_weighted_string-fst.cc
-compact16_weighted_string_fst_la_LDFLAGS = -module
+compact16_weighted_string_fst_la_LDFLAGS = -module -no-undefined -avoid-version
+compact16_weighted_string_fst_la_LIBADD = ../../lib/libfst.la
 
 compact64_acceptor_fst_la_SOURCES = compact64_acceptor-fst.cc
-compact64_acceptor_fst_la_LDFLAGS = -module
+compact64_acceptor_fst_la_LDFLAGS = -module -no-undefined -avoid-version
+compact64_acceptor_fst_la_LIBADD = ../../lib/libfst.la
 
 compact64_string_fst_la_SOURCES = compact64_string-fst.cc
-compact64_string_fst_la_LDFLAGS = -module
+compact64_string_fst_la_LDFLAGS = -module -no-undefined -avoid-version
+compact64_string_fst_la_LIBADD = ../../lib/libfst.la
 
 compact64_unweighted_fst_la_SOURCES = compact64_unweighted-fst.cc
-compact64_unweighted_fst_la_LDFLAGS = -module
+compact64_unweighted_fst_la_LDFLAGS = -module -no-undefined -avoid-version
+compact64_unweighted_fst_la_LIBADD = ../../lib/libfst.la
 
 compact64_unweighted_acceptor_fst_la_SOURCES = compact64_unweighted_acceptor-fst.cc
-compact64_unweighted_acceptor_fst_la_LDFLAGS = -module
+compact64_unweighted_acceptor_fst_la_LDFLAGS = -module -no-undefined -avoid-version
+compact64_unweighted_acceptor_fst_la_LIBADD = ../../lib/libfst.la
 
 compact64_weighted_string_fst_la_SOURCES = compact64_weighted_string-fst.cc
-compact64_weighted_string_fst_la_LDFLAGS = -module
+compact64_weighted_string_fst_la_LDFLAGS = -module -no-undefined -avoid-version
+compact64_weighted_string_fst_la_LIBADD = ../../lib/libfst.la
--- origsrc/openfst-1.2.7/src/extensions/const/Makefile.am	2011-03-12 08:54:41.000000000 +0900
+++ src/openfst-1.2.7/src/extensions/const/Makefile.am	2011-05-28 22:30:52.260277200 +0900
@@ -5,13 +5,17 @@ libfstdir = @libfstdir@
 libfst_LTLIBRARIES = libfstconst.la const8-fst.la const16-fst.la const64-fst.la
 
 libfstconst_la_SOURCES = const8-fst.cc const16-fst.cc const64-fst.cc
-libfstconst_la_LDFLAGS = -version-info 0:0:0
+libfstconst_la_LDFLAGS = -version-info 0:0:0 -no-undefined
+libfstconst_la_LIBADD = ../../lib/libfst.la
 
 const8_fst_la_SOURCES = const8-fst.cc
-const8_fst_la_LDFLAGS = -module
+const8_fst_la_LDFLAGS = -module -no-undefined -avoid-version
+const8_fst_la_LIBADD = ../../lib/libfst.la
 
 const16_fst_la_SOURCES = const16-fst.cc
-const16_fst_la_LDFLAGS = -module
+const16_fst_la_LDFLAGS = -module -no-undefined -avoid-version
+const16_fst_la_LIBADD = ../../lib/libfst.la
 
 const64_fst_la_SOURCES = const64-fst.cc
-const64_fst_la_LDFLAGS = -module
+const64_fst_la_LDFLAGS = -module -no-undefined -avoid-version
+const64_fst_la_LIBADD = ../../lib/libfst.la
--- origsrc/openfst-1.2.7/src/extensions/far/Makefile.am	2011-03-12 08:54:41.000000000 +0900
+++ src/openfst-1.2.7/src/extensions/far/Makefile.am	2011-05-28 21:06:38.790764900 +0900
@@ -10,11 +10,13 @@ libfst_LTLIBRARIES = libfstfar.la
 endif
 
 libfstfar_la_SOURCES = sttable.cc
-libfstfar_la_LDFLAGS = -version-info 0:0:0
+libfstfar_la_LDFLAGS = -version-info 0:0:0 -no-undefined
+libfstfar_la_LIBADD = ../../lib/libfst.la
 
 if HAVE_SCRIPT
-libfstfarscript_la_SOURCES = farscript.cc compile-strings.cc main.cc
-libfstfarscript_la_LDFLAGS = -version-info 0:0:0
+libfstfarscript_la_SOURCES = farscript.cc compile-strings.cc main.cc sttable.cc
+libfstfarscript_la_LDFLAGS = -version-info 0:0:0 -no-undefined
+libfstfarscript_la_LIBADD = ../../lib/libfst.la @ICU_LIBS@
 endif
 
 if HAVE_BIN
@@ -37,4 +39,4 @@ farinfo_LDADD = $(farbindeps)
 
 farprintstrings_SOURCES = farprintstrings.cc
 farprintstrings_LDADD = $(farbindeps)
-endif
\ No newline at end of file
+endif
--- origsrc/openfst-1.2.7/src/extensions/lookahead/Makefile.am	2011-03-12 08:54:41.000000000 +0900
+++ src/openfst-1.2.7/src/extensions/lookahead/Makefile.am	2011-05-28 22:31:17.831911300 +0900
@@ -7,13 +7,17 @@ ilabel_lookahead-fst.la olabel_lookahead
 
 libfstlookahead_la_SOURCES = arc_lookahead-fst.cc ilabel_lookahead-fst.cc \
 olabel_lookahead-fst.cc
-libfstlookahead_la_LDFLAGS = -version-info 0:0:0
+libfstlookahead_la_LDFLAGS = -version-info 0:0:0 -no-undefined
+libfstlookahead_la_LIBADD = ../../lib/libfst.la
 
 arc_lookahead_fst_la_SOURCES = arc_lookahead-fst.cc
-arc_lookahead_fst_la_LDFLAGS = -module
+arc_lookahead_fst_la_LDFLAGS = -module -no-undefined -avoid-version
+arc_lookahead_fst_la_LIBADD = ../../lib/libfst.la
 
 ilabel_lookahead_fst_la_SOURCES = ilabel_lookahead-fst.cc
-ilabel_lookahead_fst_la_LDFLAGS = -module
+ilabel_lookahead_fst_la_LDFLAGS = -module -no-undefined -avoid-version
+ilabel_lookahead_fst_la_LIBADD = ../../lib/libfst.la
 
 olabel_lookahead_fst_la_SOURCES = olabel_lookahead-fst.cc
-olabel_lookahead_fst_la_LDFLAGS = -module
+olabel_lookahead_fst_la_LDFLAGS = -module -no-undefined -avoid-version
+olabel_lookahead_fst_la_LIBADD = ../../lib/libfst.la
--- origsrc/openfst-1.2.7/src/extensions/pdt/Makefile.am	2011-03-12 08:54:41.000000000 +0900
+++ src/openfst-1.2.7/src/extensions/pdt/Makefile.am	2011-05-28 21:44:14.315346100 +0900
@@ -31,5 +31,6 @@ libfstdir = @libfstdir@
 if HAVE_SCRIPT
 libfst_LTLIBRARIES = libfstpdtscript.la
 libfstpdtscript_la_SOURCES = pdtscript.cc
-libfstpdtscript_la_LDFLAGS = -version-info 0:0:0
+libfstpdtscript_la_LDFLAGS = -version-info 0:0:0 -no-undefined
+libfstpdtscript_la_LIBADD = ../../lib/libfst.la ../../script/libfstscript.la
 endif
--- origsrc/openfst-1.2.7/src/include/fst/register.h	2011-03-12 09:02:41.000000000 +0900
+++ src/openfst-1.2.7/src/include/fst/register.h	2011-05-29 00:41:52.348847800 +0900
@@ -72,7 +72,11 @@ class FstRegister : public GenericRegist
 
     ConvertToLegalCSymbol(&legal_type);
 
+#if defined(__CYGWIN__)
+    return legal_type + "-fst.dll";
+#else
     return legal_type + "-fst.so";
+#endif
   }
 };
 
--- origsrc/openfst-1.2.7/src/include/fst/script/register.h	2011-03-12 09:02:46.000000000 +0900
+++ src/openfst-1.2.7/src/include/fst/script/register.h	2011-05-29 00:42:21.783545100 +0900
@@ -71,7 +71,11 @@ class FstClassIORegister
     string legal_type(key);
     ConvertToLegalCSymbol(&legal_type);
 
+#if defined(__CYGWIN__)
+    return legal_type + "-arc.dll";
+#else
     return legal_type + "-arc.so";
+#endif
   }
 };
 
--- origsrc/openfst-1.2.7/src/include/fst/script/script-impl.h	2011-03-12 09:02:46.000000000 +0900
+++ src/openfst-1.2.7/src/include/fst/script/script-impl.h	2011-05-29 00:42:57.577645800 +0900
@@ -140,7 +140,11 @@ class GenericOperationRegister
     string legal_type(key.second);  // the arc type
     ConvertToLegalCSymbol(&legal_type);
 
+#if defined(__CYGWIN__)
+    return legal_type + "-arc.dll";
+#else
     return legal_type + "-arc.so";
+#endif
   }
 };
 
--- origsrc/openfst-1.2.7/src/include/fst/script/weight-class.h	2011-03-12 09:02:46.000000000 +0900
+++ src/openfst-1.2.7/src/include/fst/script/weight-class.h	2011-05-29 00:43:49.409940900 +0900
@@ -184,7 +184,11 @@ class WeightClassRegister : public Gener
                                                    WeightClassRegister> {
  protected:
   virtual string ConvertKeyToSoFilename(const string &key) const {
+#if defined(__CYGWIN__)
+    return key + ".dll";
+#else
     return key + ".so";
+#endif
   }
 };
 
--- origsrc/openfst-1.2.7/src/lib/Makefile.am	2011-03-12 08:54:41.000000000 +0900
+++ src/openfst-1.2.7/src/lib/Makefile.am	2011-05-28 16:25:12.630545700 +0900
@@ -3,4 +3,4 @@ AM_CPPFLAGS = -I$(srcdir)/../include $(I
 lib_LTLIBRARIES = libfst.la
 libfst_la_SOURCES = compat.cc flags.cc fst.cc properties.cc \
 symbol-table.cc util.cc
-libfst_la_LDFLAGS = -version-info 0:0:0
+libfst_la_LDFLAGS = -version-info 0:0:0 -no-undefined
--- origsrc/openfst-1.2.7/src/script/Makefile.am	2011-03-12 08:54:42.000000000 +0900
+++ src/openfst-1.2.7/src/script/Makefile.am	2011-05-28 17:20:11.945624400 +0900
@@ -11,5 +11,6 @@ reverse.cc reweight.cc rmepsilon.cc scri
 shortest-path.cc synchronize.cc text-io.cc topsort.cc union.cc \
 weight-class.cc
 
-libfstscript_la_LDFLAGS = -version-info 0:0:0
+libfstscript_la_LDFLAGS = -version-info 0:0:0 -no-undefined
 endif
+libfstscript_la_LIBADD = ../lib/libfst.la
