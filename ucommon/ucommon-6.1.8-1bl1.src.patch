--- origsrc/ucommon-6.1.8/commoncpp/udp.cpp	2014-05-17 22:04:34.000000000 +0900
+++ src/ucommon-6.1.8/commoncpp/udp.cpp	2014-06-28 12:46:34.178839600 +0900
@@ -409,7 +409,7 @@ Socket::Error UDPSocket::join(const IPV4
     setsockopt(so, IPPROTO_IP, IP_ADD_MEMBERSHIP, (char *)&group, sizeof(group));
     return errSuccess;
 
-#elif defined(IP_ADD_MEMBERSHIP) && defined(SIOCGIFINDEX) && !defined(__FreeBSD__) && !defined(__FreeBSD_kernel__) && !defined(_OSF_SOURCE) && !defined(__hpux) && !defined(__GNU__)
+#elif defined(IP_ADD_MEMBERSHIP) && defined(SIOCGIFINDEX) && !defined(__FreeBSD__) && !defined(__FreeBSD_kernel__) && !defined(_OSF_SOURCE) && !defined(__hpux) && !defined(__GNU__) && !defined(__CYGWIN__)
 
         struct ip_mreqn      group;
     struct sockaddr_in   myaddr;
@@ -448,7 +448,7 @@ Socket::Error UDPSocket::join(const IPV4
 Socket::Error UDPSocket::getInterfaceIndex(const char *DeviceName,int& InterfaceIndex)
 {
 #ifndef _MSWINDOWS_
-#if defined(IP_ADD_MEMBERSHIP) && defined(SIOCGIFINDEX) && !defined(__FreeBSD__) && !defined(__FreeBSD_kernel__) && !defined(_OSF_SOURCE) && !defined(__hpux) && !defined(__GNU__)
+#if defined(IP_ADD_MEMBERSHIP) && defined(SIOCGIFINDEX) && !defined(__FreeBSD__) && !defined(__FreeBSD_kernel__) && !defined(_OSF_SOURCE) && !defined(__hpux) && !defined(__GNU__) && !defined(__CYGWIN__)
 
     struct ip_mreqn  mreqn;
     struct ifreq       m_ifreq;
--- origsrc/ucommon-6.1.8/configure.ac	2014-06-19 16:57:25.000000000 +0900
+++ src/ucommon-6.1.8/configure.ac	2014-06-28 12:46:34.194464600 +0900
@@ -59,6 +59,7 @@ have_gettext="no"
 socket_lib=""
 posix4_lib=""
 rt_lib=""
+intl_lib=""
 
 test -z "$localedir" && localedir='${datadir}/locale'
 
@@ -179,6 +180,46 @@ AC_CHECK_HEADER(regex.h, [
     ])
 ])
 
+if test "$host_os" = "cygwin"; then
+    AC_CHECK_LIB(gcc, __modsi3, [
+        UCOMMON_LIBC="$UCOMMON_LIBC -lgcc"
+    ])
+    AC_CHECK_LIB($clib, socketpair, [
+        AC_DEFINE(HAVE_SOCKETPAIR, [1], [have socketpair])
+    ],[
+            AC_CHECK_LIB(socket, socketpair, [AC_DEFINE(HAVE_SOCKETPAIR, [1], [have socketpair])])
+    ])
+    AC_CHECK_LIB($clib, getaddrinfo, [
+        AC_DEFINE(HAVE_GETADDRINFO, [1], [have getaddrinfo])
+    ],[
+            AC_CHECK_LIB(socket, getaddrinfo, [AC_DEFINE(HAVE_GETADDRINFO, [1], [have getaddrinfo])])
+    ])
+    AC_CHECK_LIB($clib, gethostbyname2, [
+        AC_DEFINE(HAVE_GETHOSTBYNAME2, [1], [have gethostbyname2])
+    ],[
+            AC_CHECK_LIB(socket, gethostbyname2, [AC_DEFINE(HAVE_GETHOSTBYNAME2, [1], [have gethostbyname2])])
+    ])
+
+    AC_CHECK_LIB($clib, inet_ntop, [
+        AC_DEFINE(HAVE_INET_NTOP, [1], [have inet ntop])
+    ],[
+        AC_CHECK_LIB(socket, inet_ntop, [
+            AC_DEFINE(HAVE_INET_NTOP, [1], [have inet ntop])
+        ],[
+            AC_CHECK_LIB(nsl, inet_ntop, [
+                AC_DEFINE(HAVE_INET_NTOP, [1], [have inet_ntop])
+                socket_lib="$socket_lib -lnsl"
+            ])
+        ])
+    ])
+
+    AC_CHECK_LIB(socket, socket,[
+        AC_CHECK_LIB(socket, socketpair,[
+            AC_DEFINE(HAVE_SOCKETPAIR, [1], [have socketpair in libsocket])
+        ])
+        socket_lib="-lsocket"
+    ])
+else
 AC_CHECK_LIB(msvcrt, fopen, [
     threading="msw"
     clib="msvcrt"
@@ -228,6 +269,7 @@ AC_CHECK_LIB(msvcrt, fopen, [
         socket_lib="-lsocket"
     ])
 ])
+fi
 
 AC_ARG_ENABLE(socks,
     AC_HELP_STRING([--enable-socks],
@@ -387,6 +429,11 @@ for func in ftok shm_open nanosleep cloc
                 if test ! -z "$tlib" ; then
                     AC_CHECK_LIB($tlib, $func, [
                         found=$func
+                    ],[
+                        AC_CHECK_LIB(intl, $func, [
+                            found=$func
+                            intl_lib="-lintl"
+                        ])
                     ])
                 fi
             ])
@@ -463,8 +510,8 @@ for func in ftok shm_open nanosleep cloc
     esac
 done
 
-UCOMMON_LINKED="$socket_lib $posix4_lib $rt_lib $UCOMMON_LIBS"
-UCOMMON_LIBS="$socket_lib $posix4_lib $rt_lib $UCOMMON_LIBS $UCOMMON_LIBC"
+UCOMMON_LINKED="$socket_lib $posix4_lib $rt_lib $intl_lib $UCOMMON_LIBS"
+UCOMMON_LIBS="$socket_lib $posix4_lib $rt_lib $intl_lib $UCOMMON_LIBS $UCOMMON_LIBC"
 
 if test "$UCOMMON_MODEL" = "CC" ; then
     AC_CHECK_LIB(Systemstubs, printf, [
@@ -670,6 +717,9 @@ AC_ARG_WITH(pkg-config,
         AC_CHECK_HEADERS(openssl/fips.h)
     ])
     PKG_CHECK_MODULES(GNUTLS, [gnutls >= 2.8.0], [], [GNUTLS_LIBS=""])
+    AC_CHECK_LIB(gnutls, gnutls_init, [
+        GNUTLS_LIBS="$GNUTLS_LIBS -lgcrypt"
+    ])
 ],[
     AC_CHECK_HEADERS(openssl/ssl.h, [
         OPENSSL_LIBS="-lssl -lcrypto -lz $OPENSSL_LINK"
--- origsrc/ucommon-6.1.8/test/Makefile.am	2014-01-29 04:43:53.000000000 +0900
+++ src/ucommon-6.1.8/test/Makefile.am	2014-06-28 12:46:34.194464600 +0900
@@ -13,9 +13,10 @@ AM_CXXFLAGS = -I$(top_srcdir)/inc $(UCOM
 LDADD = ../corelib/libucommon.la @UCOMMON_LIBS@ @UCOMMON_CLINK@
 EXTRA_DIST = *.cpp keydata.conf CMakeLists.txt
 
-TESTS = ucommonLinked ucommonSocket ucommonStrings ucommonThreads \
+# hang up : ucommonStrings ucommonDigest ucommonCipher
+TESTS = ucommonLinked ucommonSocket ucommonThreads \
 	ucommonMemory ucommonKeydata ucommonStream ucommonUnicode \
-	ucommonQueue ucommonDatetime ucommonShell ucommonDigest ucommonCipher
+	ucommonQueue ucommonDatetime ucommonShell
 
 noinst_PROGRAMS = demoSSL
 demoSSL_SOURCES = ssl.cpp
